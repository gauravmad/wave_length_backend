<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Note UI - WhatsApp Style</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f0f0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 20px;
            max-width: 400px;
            width: 100%;
        }

        .message-container {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Voice Note Message Styles */
        .voice-note-message {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 280px;
            position: relative;
            overflow: hidden;
        }

        .voice-note-sent {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .voice-note-received {
            background: #e5e5ea;
            color: #000;
            margin-right: auto;
        }

        /* Play/Pause Button */
        .play-pause-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .voice-note-sent .play-pause-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .voice-note-received .play-pause-btn {
            background: #007aff;
            color: white;
        }

        .play-pause-btn:hover {
            transform: scale(1.05);
        }

        .play-pause-btn:active {
            transform: scale(0.95);
        }

        /* Play/Pause Icons */
        .play-icon, .pause-icon {
            width: 0;
            height: 0;
            transition: all 0.2s ease;
        }

        .play-icon {
            border-left: 12px solid currentColor;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            margin-left: 2px;
        }

        .pause-icon {
            display: flex;
            gap: 3px;
        }

        .pause-bar {
            width: 3px;
            height: 16px;
            background: currentColor;
            border-radius: 1px;
        }

        /* Waveform Container */
        .waveform-container {
            flex: 1;
            height: 40px;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        /* Waveform Bars */
        .waveform {
            display: flex;
            align-items: center;
            gap: 2px;
            height: 100%;
            width: 100%;
        }

        .wave-bar {
            width: 3px;
            background: currentColor;
            border-radius: 1.5px;
            transition: all 0.3s ease;
            opacity: 0.3;
        }

        .wave-bar.active {
            opacity: 1;
            transform: scaleY(1.2);
        }

        .voice-note-sent .wave-bar {
            background: rgba(255, 255, 255, 0.8);
        }

        .voice-note-received .wave-bar {
            background: #007aff;
        }

        /* Duration Display */
        .duration {
            font-size: 12px;
            font-weight: 500;
            margin: 0 8px;
            min-width: 35px;
            text-align: center;
        }

        .voice-note-sent .duration {
            display: none; /* Hide duration for sent messages */
        }

        .voice-note-received .duration {
            color: #666;
        }

        /* Recording Controls */
        .recording-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .record-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .record-btn.ready {
            background: #ff3b30;
            color: white;
        }

        .record-btn.recording {
            background: #ff3b30;
            animation: pulse 1.5s infinite;
        }

        .record-btn.sending {
            background: #34c759;
            color: white;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .record-icon {
            width: 24px;
            height: 24px;
        }

        .mic-icon {
            width: 20px;
            height: 20px;
        }

        /* Recording Timer */
        .recording-timer {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: none;
        }

        .recording-timer.active {
            display: block;
        }

        /* Cancel/Send Buttons */
        .cancel-btn, .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .cancel-btn {
            background: #ff3b30;
            color: white;
        }

        .send-btn {
            background: #34c759;
            color: white;
        }

        .cancel-btn:hover, .send-btn:hover {
            transform: scale(1.05);
        }

        /* Status Messages */
        .status-message {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }

        .status-message.recording {
            color: #ff3b30;
        }

        .status-message.sending {
            color: #34c759;
        }

        /* Demo Controls */
        .demo-controls {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .demo-controls h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .demo-btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .demo-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <h2 style="text-align: center; margin-bottom: 20px; color: #333;">ðŸŽ¤ Voice Note UI Demo</h2>
        
        <div class="message-container" id="messageContainer">
            <!-- Voice notes will be added here -->
        </div>

        <div class="recording-controls">
            <button class="record-btn ready" id="recordBtn">
                <svg class="mic-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                </svg>
                <div class="recording-timer" id="recordingTimer">00:00</div>
            </button>
        </div>

        <div class="status-message" id="statusMessage">Tap and hold to record</div>

        <div class="demo-controls">
            <h3>Demo Controls</h3>
            <button class="demo-btn" onclick="addSampleVoiceNote('sent')">Add Sent Voice Note</button>
            <button class="demo-btn" onclick="addSampleVoiceNote('received')">Add Received Voice Note</button>
            <button class="demo-btn" onclick="clearMessages()">Clear All</button>
        </div>
    </div>

    <script>
        class VoiceNoteRecorder {
            constructor() {
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.isRecording = false;
                this.recordingStartTime = null;
                this.timerInterval = null;
                
                this.recordBtn = document.getElementById('recordBtn');
                this.recordingTimer = document.getElementById('recordingTimer');
                this.statusMessage = document.getElementById('statusMessage');
                this.messageContainer = document.getElementById('messageContainer');
                
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Mouse events
                this.recordBtn.addEventListener('mousedown', () => this.startRecording());
                this.recordBtn.addEventListener('mouseup', () => this.stopRecording());
                this.recordBtn.addEventListener('mouseleave', () => this.stopRecording());

                // Touch events
                this.recordBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.startRecording();
                });
                this.recordBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.stopRecording();
                });

                // Prevent context menu on long press
                this.recordBtn.addEventListener('contextmenu', (e) => e.preventDefault());
            }

            async startRecording() {
                if (this.isRecording) return;

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.audioChunks = [];

                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };

                    this.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                        this.handleRecordingComplete(audioBlob);
                        stream.getTracks().forEach(track => track.stop());
                    };

                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.recordingStartTime = Date.now();
                    
                    this.updateUI('recording');
                    this.startTimer();
                    
                } catch (error) {
                    console.error('Error starting recording:', error);
                    this.statusMessage.textContent = 'Error: Could not access microphone';
                }
            }

            stopRecording() {
                if (!this.isRecording) return;

                if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
                    this.mediaRecorder.stop();
                }
                
                this.isRecording = false;
                this.stopTimer();
                this.updateUI('ready');
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    const elapsed = Date.now() - this.recordingStartTime;
                    const seconds = Math.floor(elapsed / 1000);
                    const minutes = Math.floor(seconds / 60);
                    const remainingSeconds = seconds % 60;
                    
                    this.recordingTimer.textContent = 
                        `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
                }, 100);
            }

            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }

            updateUI(state) {
                this.recordBtn.className = `record-btn ${state}`;
                this.recordingTimer.className = `recording-timer ${state === 'recording' ? 'active' : ''}`;
                
                switch (state) {
                    case 'ready':
                        this.statusMessage.textContent = 'Tap and hold to record';
                        this.statusMessage.className = 'status-message';
                        break;
                    case 'recording':
                        this.statusMessage.textContent = 'Recording... Release to stop';
                        this.statusMessage.className = 'status-message recording';
                        break;
                    case 'sending':
                        this.statusMessage.textContent = 'Sending voice note...';
                        this.statusMessage.className = 'status-message sending';
                        break;
                }
            }

            handleRecordingComplete(audioBlob) {
                const duration = (Date.now() - this.recordingStartTime) / 1000;
                
                if (duration < 1) {
                    this.statusMessage.textContent = 'Recording too short. Try again.';
                    setTimeout(() => this.updateUI('ready'), 2000);
                    return;
                }

                // Create voice note message
                this.addVoiceNoteMessage('sent', audioBlob, duration);
                this.updateUI('ready');
            }

            addVoiceNoteMessage(type, audioBlob, duration) {
                const messageId = `voice_${Date.now()}`;
                const messageDiv = document.createElement('div');
                messageDiv.className = `voice-note-message voice-note-${type}`;
                messageDiv.id = messageId;

                const durationText = this.formatDuration(duration);
                const waveform = this.generateWaveform(duration);

                const durationHtml = type === 'sent' ? '' : `<div class="duration">${durationText}</div>`;
                
                messageDiv.innerHTML = `
                    <button class="play-pause-btn" onclick="togglePlayPause('${messageId}')">
                        <div class="play-icon"></div>
                        <div class="pause-icon" style="display: none;">
                            <div class="pause-bar"></div>
                            <div class="pause-bar"></div>
                        </div>
                    </button>
                    <div class="waveform-container">
                        <div class="waveform">
                            ${waveform}
                        </div>
                    </div>
                    ${durationHtml}
                `;

                // Store audio data
                messageDiv.audioBlob = audioBlob;
                messageDiv.isPlaying = false;
                messageDiv.audioElement = null;

                this.messageContainer.appendChild(messageDiv);
                this.messageContainer.scrollTop = this.messageContainer.scrollHeight;
            }

            formatDuration(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            generateWaveform(duration) {
                const barCount = Math.min(Math.max(Math.floor(duration * 8), 20), 100);
                let waveform = '';
                
                for (let i = 0; i < barCount; i++) {
                    const height = Math.random() * 30 + 5;
                    waveform += `<div class="wave-bar" style="height: ${height}px;"></div>`;
                }
                
                return waveform;
            }
        }

        // Global functions for voice note playback
        function togglePlayPause(messageId) {
            const messageDiv = document.getElementById(messageId);
            const playBtn = messageDiv.querySelector('.play-pause-btn');
            const playIcon = playBtn.querySelector('.play-icon');
            const pauseIcon = playBtn.querySelector('.pause-icon');
            const waveBars = messageDiv.querySelectorAll('.wave-bar');

            if (messageDiv.isPlaying) {
                // Pause
                if (messageDiv.audioElement) {
                    messageDiv.audioElement.pause();
                }
                messageDiv.isPlaying = false;
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
                waveBars.forEach(bar => bar.classList.remove('active'));
            } else {
                // Play
                if (!messageDiv.audioElement) {
                    const audioUrl = URL.createObjectURL(messageDiv.audioBlob);
                    messageDiv.audioElement = new Audio(audioUrl);
                    
                    messageDiv.audioElement.onended = () => {
                        messageDiv.isPlaying = false;
                        playIcon.style.display = 'block';
                        pauseIcon.style.display = 'none';
                        waveBars.forEach(bar => bar.classList.remove('active'));
                    };
                }
                
                messageDiv.audioElement.play();
                messageDiv.isPlaying = true;
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'flex';
                
                // Animate waveform
                this.animateWaveform(waveBars);
            }
        }

        function animateWaveform(waveBars) {
            waveBars.forEach((bar, index) => {
                setTimeout(() => {
                    bar.classList.add('active');
                    setTimeout(() => bar.classList.remove('active'), 200);
                }, index * 50);
            });
        }

        // Demo functions
        function addSampleVoiceNote(type) {
            const recorder = window.voiceRecorder;
            const duration = Math.random() * 30 + 5; // 5-35 seconds
            const mockBlob = new Blob(['mock audio data'], { type: 'audio/wav' });
            recorder.addVoiceNoteMessage(type, mockBlob, duration);
        }

        function clearMessages() {
            document.getElementById('messageContainer').innerHTML = '';
        }

        // Initialize the voice recorder
        window.addEventListener('DOMContentLoaded', () => {
            window.voiceRecorder = new VoiceNoteRecorder();
        });
    </script>
</body>
</html>
